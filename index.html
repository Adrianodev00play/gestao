<!DOCTYPE html>
<html lang="pt-BR" >
<head>
  <meta charset="UTF-8" />
  <title>Estoque</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * { box-sizing: border-box; }
    body { font-family: Arial, sans-serif; background: #0f0f0f; color: #eee; margin: 0; padding: 12px; }
    h1 { text-align: center; margin-bottom: 10px; }

    #menuButton {
      position: fixed; top: 12px; left: 12px; background: #2196f3;
      color: #fff; font-weight: bold; border: none; border-radius: 50%;
      width: 28px; height: 28px; font-size: 20px; line-height: 28px;
      text-align: center; cursor: pointer; z-index: 1100; padding: 0;
    }

    #menuModal {
      position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
      background: #1b1b1b; padding: 166px 24px; border-radius: 12px;
      box-shadow: 0 0 12px #000; display: none; z-index: 1200; min-width: 260px;
      padding: 20px;
    }

    #modalBackdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: none; z-index: 1150; }
    #menuModal button { width: 100%; padding: 10px 0; margin-top: 12px; border-radius: 8px; border: none; cursor: pointer; }
    #menuModal .closeBtn { background: #f44336; color: #fff; font-weight: bold; }
    button.secondary { background: #2196f3; color: #fff; }

    .card { background: #1b1b1b; padding: 12px; border-radius: 10px; margin-top: 10px; }
    input, button { width: 100%; padding: 12px; margin-top: 6px; border-radius: 8px; border: none; font-size: 16px; cursor: pointer; }
    input { background: #222; color: #fff; }

    #addButton, #searchButton { background: #4caf50; color: #000; font-weight: bold; }
    .back { background: #555; color: #fff; }

    /* BUSCA */
    #searchOverlay { position: fixed; inset: 0; background: #000; display: none; flex-direction: column; padding: 12px; z-index: 1000; }
    #searchResults { margin-top: 12px; overflow-y: auto; flex: 1; }

    #folder { background: #f39c12; color: #000; padding: 12px; border-radius: 10px; margin-top: 12px; cursor: pointer; font-weight: bold; display: flex; align-items: center; gap: 8px; max-width: 300px; }
    #folder::before { content: "üìÅ"; font-size: 22px; }
    #folderList { background: #2c2c2c; margin-top: 6px; border-radius: 8px; max-height: 250px; overflow-y: auto; display: none; padding: 8px; }

    .item-card { background: #3a3a3a; padding: 10px; border-radius: 8px; margin-bottom: 8px; }
    .item-card button { width: auto; padding: 6px 12px; font-size: 14px; margin-right: 5px; }
    .btn-danger { background: #f44336; color: #fff; }
    .btn-edit { background: #2196f3; color: #fff; }

    #message { margin-top: 12px; font-weight: bold; color: #4caf50; }
  </style>
</head>
<body>

  <button id="menuButton" onclick="openMenu()">:</button>

  <h1>Meu Estoque</h1>

  <button id="searchButton" onclick="openSearch()">üîç Pesquisar item</button>

  <div class="card">
    <h3>Novo item</h3>
    <input id="nome" placeholder="Nome do produto" />
    <input id="prateleira" placeholder="Posi√ß√£o (Ex: A1, A2...)" />
    <input id="preco" placeholder="Pre√ßo ou Observa√ß√£o" />
    <button id="addButton" onclick="addItem()">Adicionar</button>

    <div id="message"></div>
    <div id="folder" onclick="toggleFolder()">Itens armazenados</div>
    <div id="folderList"></div>
  </div>

  <div id="modalBackdrop" onclick="closeMenu()"></div>
  <div id="menuModal">
    <h2 style="color:#eee; margin-top:0;">Backup</h2>
    <button class="secondary" onclick="downloadBackup()">üì• Baixar backup</button>
    <input type="file" id="fileInput" accept=".json" onchange="restoreBackup(event)" style="font-size: 12px;"/>
    <button class="closeBtn" onclick="closeMenu()">‚úñ Fechar</button>
  </div>

  <div id="searchOverlay">
    <input id="searchInput" placeholder="Digite para buscar..." oninput="renderSearchResults()" />
    <button class="back" onclick="closeSearch()">‚¨Ö Voltar</button>
    <div id="searchResults"></div>
  </div>

  <script>
    const STORAGE_KEY = "estoque_final";
    let estoque = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
    let editIndex = null;

    function save() { localStorage.setItem(STORAGE_KEY, JSON.stringify(estoque)); }

    function addItem() {
      const nome = document.getElementById("nome").value.trim();
      const prateleira = document.getElementById("prateleira").value.trim().toUpperCase();
      const preco = document.getElementById("preco").value.trim();

      if (!nome || !prateleira) return alert("Preencha Nome e Posi√ß√£o");

      if (editIndex !== null) {
        estoque[editIndex] = { nome, prateleira, preco };
        editIndex = null;
        document.getElementById("addButton").textContent = "Adicionar";
      } else {
        estoque.push({ nome, prateleira, preco });
      }

      save();
      renderFolderList();
      resetInputs();
      showMessage("Salvo com sucesso!");
    }

    function resetInputs() {
      document.getElementById("nome").value = "";
      document.getElementById("prateleira").value = "";
      document.getElementById("preco").value = "";
    }

    function renderFolderList() {
      const list = document.getElementById("folderList");
      list.innerHTML = "";
      estoque.forEach((item, index) => {
        const div = document.createElement("div");
        div.className = "item-card";
        div.innerHTML = `
          <strong>${item.nome}</strong><br>
          <small>Posi√ß√£o: ${item.prateleira} ${item.preco ? '| ' + item.preco : ''}</small><br>
          <button class="btn-edit" onclick="editItem(${index})">‚úèÔ∏è</button>
          <button class="btn-danger" onclick="removeItem(${index})">üóë</button>
        `;
        list.appendChild(div);
      });
    }

    function editItem(index) {
      const item = estoque[index];
      document.getElementById("nome").value = item.nome;
      document.getElementById("prateleira").value = item.prateleira;
      document.getElementById("preco").value = item.preco || "";
      editIndex = index;
      document.getElementById("addButton").textContent = "Salvar Edi√ß√£o";
      closeSearch();
      window.scrollTo(0,0);
    }

    function removeItem(index) {
      if (!confirm("Apagar item?")) return;
      estoque.splice(index, 1);
      save();
      renderFolderList();
      renderSearchResults();
    }

    /* BUSCA */
    function openSearch() {
      const input = document.getElementById("searchInput");
      input.value = ""; 
      document.getElementById("searchResults").innerHTML = "";
      document.getElementById("searchOverlay").style.display = "flex";
      document.getElementById("menuButton").style.display = "none";
      input.focus();
    }

    function closeSearch() {
      document.getElementById("searchInput").value = ""; 
      document.getElementById("searchOverlay").style.display = "none";
      document.getElementById("menuButton").style.display = "block";
    }

    function renderSearchResults() {
      const query = document.getElementById("searchInput").value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
      const terms = query.split(" ").filter(t => t !== "");
      const resultsContainer = document.getElementById("searchResults");
      resultsContainer.innerHTML = "";

      if (terms.length === 0) return;

      estoque.forEach((item, index) => {
        const text = (item.nome + " " + item.prateleira + " " + (item.preco || "")).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        const match = terms.every(term => text.includes(term));

        if (match) {
          const div = document.createElement("div");
          div.className = "card";
          div.style.display = "flex";
          div.style.justifyContent = "space-between";
          div.style.alignItems = "center";
          div.innerHTML = `
            <div style="flex:1">
              <strong>${item.nome}</strong><br>
              <small>Posi√ß√£o: ${item.prateleira} ${item.preco ? '| ' + item.preco : ''}</small>
            </div>
            <div style="display:flex; gap:5px;">
              <button class="btn-edit" style="width:40px; margin:0;" onclick="editItem(${index})">‚úèÔ∏è</button>
              <button class="btn-danger" style="width:40px; margin:0;" onclick="removeItem(${index}); renderSearchResults();">üóë</button>
            </div>
          `;
          resultsContainer.appendChild(div);
        }
      });
    }

    function toggleFolder() {
      const list = document.getElementById("folderList");
      const folder = document.getElementById("folder");
      if (list.style.display === "block") {
        list.style.display = "none";
        folder.style.background = "#f39c12";
      } else {
        list.style.display = "block";
        folder.style.background = "#d35400";
      }
    }

    function showMessage(t) {
      const m = document.getElementById("message");
      m.textContent = t;
      setTimeout(() => m.textContent = "", 2000);
    }

    function openMenu() { 
      document.getElementById("menuModal").style.display = "block"; 
      document.getElementById("modalBackdrop").style.display = "block"; 
    }
    function closeMenu() { 
      document.getElementById("menuModal").style.display = "none"; 
      document.getElementById("modalBackdrop").style.display = "none"; 
    }

    function downloadBackup() {
      const blob = new Blob([JSON.stringify({estoque})], {type: "application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "estoque.json";
      a.click();
    }

    function restoreBackup(e) {
      const file = e.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = (event) => {
        try {
          const data = JSON.parse(event.target.result);
          if(data.estoque) {
            estoque = data.estoque;
            save();
            renderFolderList();
            alert("Backup restaurado com sucesso!");
            closeMenu();
          }
        } catch(err) {
          alert("Erro ao ler o arquivo.");
        }
      };
      reader.readAsText(file);
    }

    renderFolderList();
  </script>
</body>
</html>

